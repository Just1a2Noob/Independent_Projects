<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Just1a2Noob">

<title>Data Analysis using Regression Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="analysis_files/libs/quarto-html/quarto.js"></script>
<script src="analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="analysis_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="analysis_files/libs/bootstrap/bootstrap-01c739c54fac56052714b101435a3338.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#setting-up-our-environment" id="toc-setting-up-our-environment" class="nav-link" data-scroll-target="#setting-up-our-environment">Setting Up Our Environment</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a></li>
  <li><a href="#preparing-for-data-for-machine-learning" id="toc-preparing-for-data-for-machine-learning" class="nav-link" data-scroll-target="#preparing-for-data-for-machine-learning">Preparing for Data For Machine Learning</a></li>
  <li><a href="#regression-models" id="toc-regression-models" class="nav-link" data-scroll-target="#regression-models">Regression Models</a>
  <ul class="collapse">
  <li><a href="#ensemble-models" id="toc-ensemble-models" class="nav-link" data-scroll-target="#ensemble-models">Ensemble Models</a></li>
  </ul></li>
  <li><a href="#evaluating-random-forest-model" id="toc-evaluating-random-forest-model" class="nav-link" data-scroll-target="#evaluating-random-forest-model">Evaluating Random Forest Model</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Analysis using Regression Models</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Just1a2Noob </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this analysis we are going to use regression models used in Scikit-Learn to predict whether an individual has theyre loan approved and what important features that associate with the prediction.</p>
<p>The metadata description of as follows:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>person_age</td>
<td>Age of the person</td>
<td>Float</td>
</tr>
<tr class="even">
<td>person_gender</td>
<td>Gender of the person</td>
<td>Categorical</td>
</tr>
<tr class="odd">
<td>person_education</td>
<td>Highest education level</td>
<td>Categorical</td>
</tr>
<tr class="even">
<td>person_income</td>
<td>Annual income</td>
<td>Float</td>
</tr>
<tr class="odd">
<td>person_emp_exp</td>
<td>Years of employment experience</td>
<td>Integer</td>
</tr>
<tr class="even">
<td>person_home_ownership</td>
<td>Home ownership status (e.g., rent, own, mortgage)</td>
<td>Categorical</td>
</tr>
<tr class="odd">
<td>loan_amnt</td>
<td>Loan amount requested</td>
<td>Float</td>
</tr>
<tr class="even">
<td>loan_intent</td>
<td>Purpose of the loan</td>
<td>Categorical</td>
</tr>
<tr class="odd">
<td>loan_int_rate</td>
<td>Loan interest rat</td>
<td>Float</td>
</tr>
<tr class="even">
<td>loan_percent_income</td>
<td>Loan amount as a percentage of annual income</td>
<td>Float</td>
</tr>
<tr class="odd">
<td>cb_person_cred_hist_length</td>
<td>Length of credit history in years</td>
<td>Float</td>
</tr>
<tr class="even">
<td>credit_score</td>
<td>Credit score of the person</td>
<td>Integer</td>
</tr>
<tr class="odd">
<td>previous_loan_defaults_on_file</td>
<td>Indicator of previous loan defaults</td>
<td>Categorical</td>
</tr>
<tr class="even">
<td>loan_status (target variable)</td>
<td>Loan approval status: 1 = approved; 0 = rejected</td>
<td>Integer</td>
</tr>
</tbody>
</table>
<section id="setting-up-our-environment" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-our-environment">Setting Up Our Environment</h2>
<div id="504cdd1f" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"loan_data.csv"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">person_age</th>
<th data-quarto-table-cell-role="th">person_gender</th>
<th data-quarto-table-cell-role="th">person_education</th>
<th data-quarto-table-cell-role="th">person_income</th>
<th data-quarto-table-cell-role="th">person_emp_exp</th>
<th data-quarto-table-cell-role="th">person_home_ownership</th>
<th data-quarto-table-cell-role="th">loan_amnt</th>
<th data-quarto-table-cell-role="th">loan_intent</th>
<th data-quarto-table-cell-role="th">loan_int_rate</th>
<th data-quarto-table-cell-role="th">loan_percent_income</th>
<th data-quarto-table-cell-role="th">cb_person_cred_hist_length</th>
<th data-quarto-table-cell-role="th">credit_score</th>
<th data-quarto-table-cell-role="th">previous_loan_defaults_on_file</th>
<th data-quarto-table-cell-role="th">loan_status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>22.0</td>
<td>female</td>
<td>Master</td>
<td>71948.0</td>
<td>0</td>
<td>RENT</td>
<td>35000.0</td>
<td>PERSONAL</td>
<td>16.02</td>
<td>0.49</td>
<td>3.0</td>
<td>561</td>
<td>No</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>21.0</td>
<td>female</td>
<td>High School</td>
<td>12282.0</td>
<td>0</td>
<td>OWN</td>
<td>1000.0</td>
<td>EDUCATION</td>
<td>11.14</td>
<td>0.08</td>
<td>2.0</td>
<td>504</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>25.0</td>
<td>female</td>
<td>High School</td>
<td>12438.0</td>
<td>3</td>
<td>MORTGAGE</td>
<td>5500.0</td>
<td>MEDICAL</td>
<td>12.87</td>
<td>0.44</td>
<td>3.0</td>
<td>635</td>
<td>No</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>23.0</td>
<td>female</td>
<td>Bachelor</td>
<td>79753.0</td>
<td>0</td>
<td>RENT</td>
<td>35000.0</td>
<td>MEDICAL</td>
<td>15.23</td>
<td>0.44</td>
<td>2.0</td>
<td>675</td>
<td>No</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>24.0</td>
<td>male</td>
<td>Master</td>
<td>66135.0</td>
<td>1</td>
<td>RENT</td>
<td>35000.0</td>
<td>MEDICAL</td>
<td>14.27</td>
<td>0.53</td>
<td>4.0</td>
<td>586</td>
<td>No</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="3fe2d693" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df.hist(bins<span class="op">=</span><span class="dv">100</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">15</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_files/figure-html/cell-3-output-1.png" width="1550" height="1170" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The graphs above gives us graph of all numerical columns in terms of frequency. From a glance we can see that the column’s</p>
<div id="17eee24f" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, StratifiedShuffleSplit</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This if for splitting the data</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>train_set, test_set <span class="op">=</span> train_test_split(df, test_size<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># stratified sampling on the target</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>stratified_shuffle <span class="op">=</span> StratifiedShuffleSplit(n_splits<span class="op">=</span><span class="dv">1</span>, test_size<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train_index, test_index <span class="kw">in</span> stratified_shuffle.split(df, df[<span class="st">"loan_status"</span>]):</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    strat_train_set <span class="op">=</span> df.loc[train_index]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    strat_test_set <span class="op">=</span> df.loc[test_index]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>loan_status <span class="op">=</span> strat_train_set.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<div id="50088af6" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.plotting <span class="im">import</span> scatter_matrix</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>attributes <span class="op">=</span> [</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"person_age"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"person_income"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"loan_percent_income"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"credit_score"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"person_emp_exp"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"loan_amnt"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>scatter_matrix(loan_status[attributes], figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>array([[&lt;Axes: xlabel='person_age', ylabel='person_age'&gt;,
        &lt;Axes: xlabel='person_income', ylabel='person_age'&gt;,
        &lt;Axes: xlabel='loan_percent_income', ylabel='person_age'&gt;,
        &lt;Axes: xlabel='credit_score', ylabel='person_age'&gt;,
        &lt;Axes: xlabel='person_emp_exp', ylabel='person_age'&gt;,
        &lt;Axes: xlabel='loan_amnt', ylabel='person_age'&gt;],
       [&lt;Axes: xlabel='person_age', ylabel='person_income'&gt;,
        &lt;Axes: xlabel='person_income', ylabel='person_income'&gt;,
        &lt;Axes: xlabel='loan_percent_income', ylabel='person_income'&gt;,
        &lt;Axes: xlabel='credit_score', ylabel='person_income'&gt;,
        &lt;Axes: xlabel='person_emp_exp', ylabel='person_income'&gt;,
        &lt;Axes: xlabel='loan_amnt', ylabel='person_income'&gt;],
       [&lt;Axes: xlabel='person_age', ylabel='loan_percent_income'&gt;,
        &lt;Axes: xlabel='person_income', ylabel='loan_percent_income'&gt;,
        &lt;Axes: xlabel='loan_percent_income', ylabel='loan_percent_income'&gt;,
        &lt;Axes: xlabel='credit_score', ylabel='loan_percent_income'&gt;,
        &lt;Axes: xlabel='person_emp_exp', ylabel='loan_percent_income'&gt;,
        &lt;Axes: xlabel='loan_amnt', ylabel='loan_percent_income'&gt;],
       [&lt;Axes: xlabel='person_age', ylabel='credit_score'&gt;,
        &lt;Axes: xlabel='person_income', ylabel='credit_score'&gt;,
        &lt;Axes: xlabel='loan_percent_income', ylabel='credit_score'&gt;,
        &lt;Axes: xlabel='credit_score', ylabel='credit_score'&gt;,
        &lt;Axes: xlabel='person_emp_exp', ylabel='credit_score'&gt;,
        &lt;Axes: xlabel='loan_amnt', ylabel='credit_score'&gt;],
       [&lt;Axes: xlabel='person_age', ylabel='person_emp_exp'&gt;,
        &lt;Axes: xlabel='person_income', ylabel='person_emp_exp'&gt;,
        &lt;Axes: xlabel='loan_percent_income', ylabel='person_emp_exp'&gt;,
        &lt;Axes: xlabel='credit_score', ylabel='person_emp_exp'&gt;,
        &lt;Axes: xlabel='person_emp_exp', ylabel='person_emp_exp'&gt;,
        &lt;Axes: xlabel='loan_amnt', ylabel='person_emp_exp'&gt;],
       [&lt;Axes: xlabel='person_age', ylabel='loan_amnt'&gt;,
        &lt;Axes: xlabel='person_income', ylabel='loan_amnt'&gt;,
        &lt;Axes: xlabel='loan_percent_income', ylabel='loan_amnt'&gt;,
        &lt;Axes: xlabel='credit_score', ylabel='loan_amnt'&gt;,
        &lt;Axes: xlabel='person_emp_exp', ylabel='loan_amnt'&gt;,
        &lt;Axes: xlabel='loan_amnt', ylabel='loan_amnt'&gt;]], dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_files/figure-html/cell-5-output-2.png" width="973" height="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The graph above is a correlation matrix shown in terms of graphs. The columns used are age, income, loan percent income, credit score, employment experience, and loan amount. From the graph we can see that multiple graphs are scattered making it hard to find any meaningful patterns just from graphs alone. But we can see outliers and anomalies from these graphs.</p>
<p>We can see an anomaly in the data in the age group there are some people who are more than 80 years old.</p>
<div id="53e88865" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">'person_age'</span>] <span class="op">&gt;=</span> <span class="dv">80</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">person_age</th>
<th data-quarto-table-cell-role="th">person_gender</th>
<th data-quarto-table-cell-role="th">person_education</th>
<th data-quarto-table-cell-role="th">person_income</th>
<th data-quarto-table-cell-role="th">person_emp_exp</th>
<th data-quarto-table-cell-role="th">person_home_ownership</th>
<th data-quarto-table-cell-role="th">loan_amnt</th>
<th data-quarto-table-cell-role="th">loan_intent</th>
<th data-quarto-table-cell-role="th">loan_int_rate</th>
<th data-quarto-table-cell-role="th">loan_percent_income</th>
<th data-quarto-table-cell-role="th">cb_person_cred_hist_length</th>
<th data-quarto-table-cell-role="th">credit_score</th>
<th data-quarto-table-cell-role="th">previous_loan_defaults_on_file</th>
<th data-quarto-table-cell-role="th">loan_status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">81</td>
<td>144.0</td>
<td>male</td>
<td>Bachelor</td>
<td>300616.0</td>
<td>125</td>
<td>RENT</td>
<td>4800.0</td>
<td>VENTURE</td>
<td>13.57</td>
<td>0.02</td>
<td>3.0</td>
<td>789</td>
<td>No</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">183</td>
<td>144.0</td>
<td>male</td>
<td>Associate</td>
<td>241424.0</td>
<td>121</td>
<td>MORTGAGE</td>
<td>6000.0</td>
<td>EDUCATION</td>
<td>11.86</td>
<td>0.02</td>
<td>2.0</td>
<td>807</td>
<td>No</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">575</td>
<td>123.0</td>
<td>female</td>
<td>High School</td>
<td>97140.0</td>
<td>101</td>
<td>RENT</td>
<td>20400.0</td>
<td>EDUCATION</td>
<td>10.25</td>
<td>0.21</td>
<td>3.0</td>
<td>805</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">747</td>
<td>123.0</td>
<td>male</td>
<td>Bachelor</td>
<td>94723.0</td>
<td>100</td>
<td>RENT</td>
<td>20000.0</td>
<td>VENTURE</td>
<td>11.01</td>
<td>0.21</td>
<td>4.0</td>
<td>714</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32297</td>
<td>144.0</td>
<td>female</td>
<td>Associate</td>
<td>7200766.0</td>
<td>124</td>
<td>MORTGAGE</td>
<td>5000.0</td>
<td>PERSONAL</td>
<td>12.73</td>
<td>0.00</td>
<td>25.0</td>
<td>850</td>
<td>No</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32416</td>
<td>94.0</td>
<td>male</td>
<td>High School</td>
<td>29738.0</td>
<td>76</td>
<td>RENT</td>
<td>6500.0</td>
<td>MEDICAL</td>
<td>11.01</td>
<td>0.22</td>
<td>27.0</td>
<td>773</td>
<td>No</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32422</td>
<td>80.0</td>
<td>male</td>
<td>High School</td>
<td>77894.0</td>
<td>62</td>
<td>RENT</td>
<td>6800.0</td>
<td>MEDICAL</td>
<td>11.71</td>
<td>0.09</td>
<td>25.0</td>
<td>673</td>
<td>No</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32506</td>
<td>84.0</td>
<td>male</td>
<td>High School</td>
<td>114705.0</td>
<td>61</td>
<td>MORTGAGE</td>
<td>10000.0</td>
<td>PERSONAL</td>
<td>7.51</td>
<td>0.09</td>
<td>24.0</td>
<td>784</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">37930</td>
<td>116.0</td>
<td>male</td>
<td>Bachelor</td>
<td>5545545.0</td>
<td>93</td>
<td>MORTGAGE</td>
<td>3823.0</td>
<td>VENTURE</td>
<td>12.15</td>
<td>0.00</td>
<td>24.0</td>
<td>708</td>
<td>No</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38113</td>
<td>109.0</td>
<td>male</td>
<td>High School</td>
<td>5556399.0</td>
<td>85</td>
<td>MORTGAGE</td>
<td>6195.0</td>
<td>VENTURE</td>
<td>12.58</td>
<td>0.00</td>
<td>22.0</td>
<td>792</td>
<td>No</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Also, we see an outlier in the person employed experience, some reaching above 100.</p>
<div id="f2798568" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">'person_emp_exp'</span>] <span class="op">&gt;=</span> <span class="dv">100</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">person_age</th>
<th data-quarto-table-cell-role="th">person_gender</th>
<th data-quarto-table-cell-role="th">person_education</th>
<th data-quarto-table-cell-role="th">person_income</th>
<th data-quarto-table-cell-role="th">person_emp_exp</th>
<th data-quarto-table-cell-role="th">person_home_ownership</th>
<th data-quarto-table-cell-role="th">loan_amnt</th>
<th data-quarto-table-cell-role="th">loan_intent</th>
<th data-quarto-table-cell-role="th">loan_int_rate</th>
<th data-quarto-table-cell-role="th">loan_percent_income</th>
<th data-quarto-table-cell-role="th">cb_person_cred_hist_length</th>
<th data-quarto-table-cell-role="th">credit_score</th>
<th data-quarto-table-cell-role="th">previous_loan_defaults_on_file</th>
<th data-quarto-table-cell-role="th">loan_status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">81</td>
<td>144.0</td>
<td>male</td>
<td>Bachelor</td>
<td>300616.0</td>
<td>125</td>
<td>RENT</td>
<td>4800.0</td>
<td>VENTURE</td>
<td>13.57</td>
<td>0.02</td>
<td>3.0</td>
<td>789</td>
<td>No</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">183</td>
<td>144.0</td>
<td>male</td>
<td>Associate</td>
<td>241424.0</td>
<td>121</td>
<td>MORTGAGE</td>
<td>6000.0</td>
<td>EDUCATION</td>
<td>11.86</td>
<td>0.02</td>
<td>2.0</td>
<td>807</td>
<td>No</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">575</td>
<td>123.0</td>
<td>female</td>
<td>High School</td>
<td>97140.0</td>
<td>101</td>
<td>RENT</td>
<td>20400.0</td>
<td>EDUCATION</td>
<td>10.25</td>
<td>0.21</td>
<td>3.0</td>
<td>805</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">747</td>
<td>123.0</td>
<td>male</td>
<td>Bachelor</td>
<td>94723.0</td>
<td>100</td>
<td>RENT</td>
<td>20000.0</td>
<td>VENTURE</td>
<td>11.01</td>
<td>0.21</td>
<td>4.0</td>
<td>714</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32297</td>
<td>144.0</td>
<td>female</td>
<td>Associate</td>
<td>7200766.0</td>
<td>124</td>
<td>MORTGAGE</td>
<td>5000.0</td>
<td>PERSONAL</td>
<td>12.73</td>
<td>0.00</td>
<td>25.0</td>
<td>850</td>
<td>No</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And finally individuals who have an abnormally large income and abnormally low income we are going to ignore that and accept them because they are within the realm of possibilities but at the extreme level.</p>
</section>
<section id="preparing-for-data-for-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="preparing-for-data-for-machine-learning">Preparing for Data For Machine Learning</h2>
<p>I am gonna apply both OrdinalEncoder, OneHotEncoder, and StandardScaler to our inputs data set.</p>
<div id="c04b931c" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> BaseEstimator, TransformerMixin</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OrdinalEncoder, OneHotEncoder, StandardScaler</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Convert_Encoder(BaseEstimator, TransformerMixin):</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Converts previous_loan_defaults_on_file column to binary</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        enc <span class="op">=</span> OrdinalEncoder(categories<span class="op">=</span>[[<span class="st">"No"</span>, <span class="st">"Yes"</span>]])</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        X[<span class="st">"previous_loan_defaults_on_file"</span>] <span class="op">=</span> enc.fit_transform(</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            X[[<span class="st">"previous_loan_defaults_on_file"</span>]]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        ).astype(<span class="bu">int</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> X</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Convert_Categorical(BaseEstimator, TransformerMixin):</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply OneHotEncoder to every categorical column</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        categorical_columns <span class="op">=</span> [</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">"person_gender"</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">"person_education"</span>,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">"person_home_ownership"</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"loan_intent"</span>,</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        ohe <span class="op">=</span> OneHotEncoder()</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> categorical_columns:</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>            unique_values <span class="op">=</span> X[col].unique()</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            column_names <span class="op">=</span> [<span class="bu">str</span>(value) <span class="cf">for</span> value <span class="kw">in</span> unique_values]</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>            matrix <span class="op">=</span> ohe.fit_transform(X[[col]]).toarray()</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(matrix.T)):</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>                X[<span class="bu">str</span>(col) <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> column_names[i]] <span class="op">=</span> matrix.T[i]</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> X.drop([col], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> X</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomStandardScaler(BaseEstimator, TransformerMixin):</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Applies StandardScaler and keeps the column names</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the standard scaler</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store column names for later use</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.columns <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store column names before scaling</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.columns <span class="op">=</span> X.columns</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fit the scaler</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.scaler.fit(X)</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Transform the data</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>        scaled_data <span class="op">=</span> <span class="va">self</span>.scaler.transform(X)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert back to DataFrame with original column names</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame(scaled_data, columns<span class="op">=</span><span class="va">self</span>.columns, index<span class="op">=</span>X.index)</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>X_inputs <span class="op">=</span> strat_test_set.drop(<span class="st">"loan_status"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>y_labels <span class="op">=</span> strat_test_set[<span class="st">"loan_status"</span>].copy()</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"Converting yes/no column"</span>, Convert_Encoder()),</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"Converts categorical columns"</span>, Convert_Categorical()),</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"Std scaler"</span>, CustomStandardScaler()),</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>X_transformed <span class="op">=</span> pipe.fit_transform(X_inputs)</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>X_transformed.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">person_age</th>
<th data-quarto-table-cell-role="th">person_income</th>
<th data-quarto-table-cell-role="th">person_emp_exp</th>
<th data-quarto-table-cell-role="th">loan_amnt</th>
<th data-quarto-table-cell-role="th">loan_int_rate</th>
<th data-quarto-table-cell-role="th">loan_percent_income</th>
<th data-quarto-table-cell-role="th">cb_person_cred_hist_length</th>
<th data-quarto-table-cell-role="th">credit_score</th>
<th data-quarto-table-cell-role="th">previous_loan_defaults_on_file</th>
<th data-quarto-table-cell-role="th">person_gender_male</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">person_home_ownership_MORTGAGE</th>
<th data-quarto-table-cell-role="th">person_home_ownership_RENT</th>
<th data-quarto-table-cell-role="th">person_home_ownership_OWN</th>
<th data-quarto-table-cell-role="th">person_home_ownership_OTHER</th>
<th data-quarto-table-cell-role="th">loan_intent_MEDICAL</th>
<th data-quarto-table-cell-role="th">loan_intent_VENTURE</th>
<th data-quarto-table-cell-role="th">loan_intent_DEBTCONSOLIDATION</th>
<th data-quarto-table-cell-role="th">loan_intent_PERSONAL</th>
<th data-quarto-table-cell-role="th">loan_intent_EDUCATION</th>
<th data-quarto-table-cell-role="th">loan_intent_HOMEIMPROVEMENT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">17620</td>
<td>-0.775777</td>
<td>-0.363254</td>
<td>-0.870295</td>
<td>-0.935767</td>
<td>1.536813</td>
<td>-0.676373</td>
<td>-0.48886</td>
<td>-0.122002</td>
<td>-1.013874</td>
<td>-0.901493</td>
<td>...</td>
<td>1.201248</td>
<td>-0.054855</td>
<td>-0.262699</td>
<td>-1.047342</td>
<td>-0.435714</td>
<td>-0.50451</td>
<td>-0.338658</td>
<td>2.052157</td>
<td>-0.455062</td>
<td>-0.454528</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">34108</td>
<td>-0.139778</td>
<td>-0.551681</td>
<td>-0.079677</td>
<td>-1.107848</td>
<td>-1.349929</td>
<td>-0.561811</td>
<td>-0.48886</td>
<td>-0.673510</td>
<td>0.986316</td>
<td>1.109272</td>
<td>...</td>
<td>-0.832468</td>
<td>-0.054855</td>
<td>-0.262699</td>
<td>0.954798</td>
<td>-0.435714</td>
<td>-0.50451</td>
<td>-0.338658</td>
<td>-0.487292</td>
<td>-0.455062</td>
<td>2.200083</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27743</td>
<td>-0.139778</td>
<td>1.397831</td>
<td>-0.395924</td>
<td>-0.247441</td>
<td>0.742876</td>
<td>-1.134620</td>
<td>0.26915</td>
<td>0.232540</td>
<td>-1.013874</td>
<td>1.109272</td>
<td>...</td>
<td>1.201248</td>
<td>-0.054855</td>
<td>-0.262699</td>
<td>-1.047342</td>
<td>-0.435714</td>
<td>-0.50451</td>
<td>-0.338658</td>
<td>2.052157</td>
<td>-0.455062</td>
<td>-0.454528</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38579</td>
<td>2.086216</td>
<td>-0.141827</td>
<td>1.975930</td>
<td>0.065435</td>
<td>-0.509485</td>
<td>0.125560</td>
<td>2.29051</td>
<td>1.414344</td>
<td>0.986316</td>
<td>1.109272</td>
<td>...</td>
<td>1.201248</td>
<td>-0.054855</td>
<td>-0.262699</td>
<td>-1.047342</td>
<td>-0.435714</td>
<td>-0.50451</td>
<td>-0.338658</td>
<td>2.052157</td>
<td>-0.455062</td>
<td>-0.454528</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32920</td>
<td>0.814219</td>
<td>-0.204889</td>
<td>1.185312</td>
<td>1.004061</td>
<td>0.915615</td>
<td>1.385740</td>
<td>0.77449</td>
<td>0.685565</td>
<td>-1.013874</td>
<td>1.109272</td>
<td>...</td>
<td>1.201248</td>
<td>-0.054855</td>
<td>-0.262699</td>
<td>-1.047342</td>
<td>-0.435714</td>
<td>-0.50451</td>
<td>-0.338658</td>
<td>-0.487292</td>
<td>-0.455062</td>
<td>2.200083</td>
</tr>
</tbody>
</table>

<p>5 rows × 26 columns</p>
</div>
</div>
</div>
</section>
<section id="regression-models" class="level2">
<h2 class="anchored" data-anchor-id="regression-models">Regression Models</h2>
<p>Our first model is linear regression. Below is the results of using Linear Regression model:</p>
<div id="da6e3742" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>lin_reg <span class="op">=</span> LinearRegression()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>lin_reg.fit(X_transformed, y_labels)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>linear_pred <span class="op">=</span> lin_reg.predict(X_transformed)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>linear_rmse <span class="op">=</span> mean_squared_error(y_labels, linear_pred)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The RMSE of Linear regression is: </span><span class="sc">{</span>linear_rmse<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The RMSE of Linear regression is: 0.09151359317606521</code></pre>
</div>
</div>
<p>And below is Decision Tree regression:</p>
<div id="f47c8e91" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>tree_reg <span class="op">=</span> DecisionTreeRegressor()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>tree_reg.fit(X_transformed, y_labels)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>tree_pred <span class="op">=</span> tree_reg.predict(X_transformed)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>tree_rmse <span class="op">=</span> mean_squared_error(y_labels, tree_pred)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The RMSE of DecisionTree regression is: </span><span class="sc">{</span>tree_rmse<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The RMSE of DecisionTree regression is: 0.0</code></pre>
</div>
</div>
<p>We can instantly notice that the Decision Tree has an abnormal error rate of 0. This means it is overfitting that data to solve this we are going to use cross validation. For that we are going to use Scikit-Learn’s K-fold cross validation feature.</p>
<div id="6f0c8af2" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>lin_scores <span class="op">=</span> cross_val_score(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    lin_reg, X_transformed, y_labels, scoring<span class="op">=</span><span class="st">"neg_mean_squared_error"</span>, cv<span class="op">=</span><span class="dv">10</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>tree_scores <span class="op">=</span> cross_val_score(</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  tree_reg, X_transformed, y_labels, scoring<span class="op">=</span><span class="st">"neg_mean_squared_error"</span>, cv<span class="op">=</span><span class="dv">10</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display_scores(scores):</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Scores:"</span>, scores)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Mean:"</span>, scores.mean())</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Standard deviation:"</span>, scores.std())</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>linear_rmse_scores <span class="op">=</span> np.sqrt(<span class="op">-</span>lin_scores)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>tree_rmse_scores <span class="op">=</span> np.sqrt(<span class="op">-</span>tree_scores)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------LinearRegression-------"</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>display_scores(linear_rmse_scores)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------DecisionTreeRegressor-------"</span>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>display_scores(tree_rmse_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>------LinearRegression-------
Scores: [0.30052724 0.30678551 0.31291029 0.29784632 0.32257665 0.29566726
 0.30382045 0.31012905 0.2910257  0.30492176]
Mean: 0.30462102394400375
Standard deviation: 0.008686365716006658


------DecisionTreeRegressor-------
Scores: [0.33993463 0.34156503 0.34318767 0.33499585 0.32659863 0.33829639
 0.33166248 0.36362374 0.32489314 0.33166248]
Mean: 0.3376420043101835
Standard deviation: 0.010439733546077575</code></pre>
</div>
</div>
<section id="ensemble-models" class="level3">
<h3 class="anchored" data-anchor-id="ensemble-models">Ensemble Models</h3>
<p>We are going to use simple ensemble models with the purpose of seeing whether using ensemble methods are better compared to linear regression and decision tree.</p>
<p>The ensemble method we are going to use is Random Forests which works by training many Decision Trees on random subsets of the features, then averaging out their predictions.</p>
<div id="ac1f6cf9" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>forest_reg <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>forest_reg.fit(X_transformed, y_labels)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>forest_pred <span class="op">=</span> forest_reg.predict(X_transformed)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>forest_mse <span class="op">=</span> mean_squared_error(y_labels, forest_pred)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>forest_rsme <span class="op">=</span> np.sqrt(forest_mse)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"This is the RMSE of Forest Regression: </span><span class="sc">{</span>forest_rsme<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>This is the RMSE of Forest Regression: 0.08962607507490962</code></pre>
</div>
</div>
<div id="8d1da528" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>forest_scores <span class="op">=</span> cross_val_score(forest_reg, X_transformed, y_labels, scoring<span class="op">=</span><span class="st">"neg_mean_squared_error"</span>, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>forest_rmse_scores <span class="op">=</span> np.sqrt(<span class="op">-</span>forest_scores)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>display_scores(forest_rmse_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Scores: [0.23678471 0.2384657  0.24573812 0.23353491 0.24428717 0.22661225
 0.24748962 0.25981083 0.21827735 0.23925927]
Mean: 0.23902599268416766
Standard deviation: 0.010938583049280658</code></pre>
</div>
</div>
<p>From the looks of it Random Forests looks very promising. However, not that the score on the training set is still much lower than on the validation sets, meaning that the model is still overfitting the training set. We can fine-tune Forest Regressor using the <code>RandomizedSearchCV</code> class from Scikit-Learn which searches a range of parameters and finds the best parameters.</p>
<div id="b4665491" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RandomizedSearchCV</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> randint</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>parameter_distribs <span class="op">=</span> {</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">'n_estimators'</span>: randint(low<span class="op">=</span><span class="dv">1</span>, high<span class="op">=</span><span class="dv">200</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">'max_features'</span>: randint(low<span class="op">=</span><span class="dv">1</span>, high<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>forest_random_search <span class="op">=</span> RandomizedSearchCV(</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  forest_reg,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  param_distributions<span class="op">=</span>parameter_distribs, </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  n_iter<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  cv<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  scoring<span class="op">=</span><span class="st">"neg_mean_squared_error"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>forest_random_search.fit(X_transformed, y_labels)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>cvres <span class="op">=</span> forest_random_search.cv_results_</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mean_score, params <span class="kw">in</span> <span class="bu">zip</span>(cvres[<span class="st">"mean_test_score"</span>], cvres[<span class="st">"params"</span>]):</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(np.sqrt(<span class="op">-</span>mean_score), params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>0.2746094717895154 {'max_features': 1, 'n_estimators': 131}
0.23790529375461852 {'max_features': 16, 'n_estimators': 46}
0.23826400000974296 {'max_features': 11, 'n_estimators': 55}
0.2739916380138001 {'max_features': 1, 'n_estimators': 148}
0.2363831686794999 {'max_features': 7, 'n_estimators': 102}
0.2371851646453085 {'max_features': 18, 'n_estimators': 186}
0.2380742296910256 {'max_features': 18, 'n_estimators': 55}
0.23869965857992517 {'max_features': 6, 'n_estimators': 48}
0.23604409380594266 {'max_features': 12, 'n_estimators': 179}
0.23686639779080887 {'max_features': 10, 'n_estimators': 91}</code></pre>
</div>
</div>
<p>From here we can see the best parameters of Random Forest model, we can also see each feature.</p>
<div id="fbabf442" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> forest_random_search.best_estimator_.feature_importances_</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>feature_importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">'feature'</span>: X_transformed.columns,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">'importance'</span>: importances,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>feature_importance_df <span class="op">=</span> feature_importance_df.sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>feature_importance_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature</th>
<th data-quarto-table-cell-role="th">importance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>previous_loan_defaults_on_file</td>
<td>0.236508</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>loan_percent_income</td>
<td>0.168208</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>loan_int_rate</td>
<td>0.160503</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>person_income</td>
<td>0.112788</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>credit_score</td>
<td>0.057974</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>person_home_ownership_OTHER</td>
<td>0.053210</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>loan_amnt</td>
<td>0.042685</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>person_age</td>
<td>0.023074</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>person_emp_exp</td>
<td>0.021942</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>cb_person_cred_hist_length</td>
<td>0.021714</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>person_home_ownership_MORTGAGE</td>
<td>0.016325</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>loan_intent_MEDICAL</td>
<td>0.011105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>loan_intent_DEBTCONSOLIDATION</td>
<td>0.010445</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>loan_intent_PERSONAL</td>
<td>0.009165</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>person_home_ownership_OWN</td>
<td>0.009027</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>loan_intent_VENTURE</td>
<td>0.006374</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>loan_intent_HOMEIMPROVEMENT</td>
<td>0.005361</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>person_education_Bachelor</td>
<td>0.005194</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>loan_intent_EDUCATION</td>
<td>0.004966</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>person_education_Master</td>
<td>0.004935</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>person_gender_female</td>
<td>0.004652</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>person_gender_male</td>
<td>0.004451</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>person_education_High School</td>
<td>0.004390</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>person_education_Doctorate</td>
<td>0.004006</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>person_education_Associate</td>
<td>0.000692</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>person_home_ownership_RENT</td>
<td>0.000307</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="evaluating-random-forest-model" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-random-forest-model">Evaluating Random Forest Model</h2>
<p>After cleaning and fine-tuning our Random Forest we now evaluate models using the test set prepared beforehand.</p>
<div id="9cb37676" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> forest_random_search.best_estimator_</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> strat_test_set.drop(<span class="st">"loan_status"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>Y_test <span class="op">=</span> strat_test_set[<span class="st">"loan_status"</span>].copy()</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>X_test_prepared <span class="op">=</span> pipe.fit_transform(X_test)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>final_predictions <span class="op">=</span> final_model.predict(X_test_prepared)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>final_mse <span class="op">=</span> mean_squared_error(Y_test, final_predictions)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>final_rmse <span class="op">=</span> np.sqrt(final_mse)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>final_rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>np.float64(0.08772513273597708)</code></pre>
</div>
</div>
<p>Here we can see the predicted RMSE of the Random Forest with the best parameters we had found. Additionally, we can compute the 95% confidence interval for the test RMSE:</p>
<div id="6aceaf39" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>confidence <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>squared_errors <span class="op">=</span> (final_predictions <span class="op">-</span> Y_test) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>np.sqrt(stats.t.interval(confidence, <span class="bu">len</span>(squared_errors) <span class="op">-</span> <span class="dv">1</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                         loc<span class="op">=</span>squared_errors.mean(),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                         scale<span class="op">=</span>stats.sem(squared_errors),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>array([0.08523699, 0.09014462])</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>